<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jan 9, 2013 ( $Revision: 1.1 $ ) -->
<!-- $HeadURL: https://svn.apache.org/repos/asf/commons/proper/commons-skin/trunk/src/main/resources/META-INF/maven/site.vm $ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
  <title>
    The Commons Math User Guide - Optimization</title> 
  <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style> 
  <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" /> 
  <meta name="Date-Revision-yyyymmdd" content="20130109" /> 
  <meta http-equiv="Content-Language" content="en" /> 
  <link rel="stylesheet" type="text/css" media="all" href="../css/prettify.css" /> 
  <script src="../js/prettify.js" type="text/javascript"></script> 
  <script type="text/javascript">window.onload=function() {
            prettyPrint();
        }</script> 
 </head> 
 <body class="composite"> 
  <div id="banner"> 
   <div id="bannerLeft"> 
    <a href="http://commons.apache.org/" title="Apache Commons logo"> <img src="../images/commons-logo.png" alt="Apache Commons logo" /> </a> 
   </div> 
   <!-- id="bannerLeft" --> 
   <div id="bannerRight"> 
    <a href="../index.html"> <img src="../images/math.gif" alt="Commons Math" /> </a> 
   </div> 
   <!-- id="bannerRight" --> 
   <div class="clear"> 
    <hr /> 
   </div> 
  </div> 
  <div id="breadcrumbs"> 
   <div class="xleft"> 
    <span id="publishDate">Last Published: 09 January 2013</span> &nbsp;| 
    <span id="projectVersion">Version: 3.1.1</span> 
   </div> 
   <div class="xright"> 
    <a href="http://www.apachecon.com/" class="externalLink" title="ApacheCon">ApacheCon</a> | 
    <a href="http://www.apache.org" class="externalLink" title="Apache">Apache</a> | 
    <a href="../../" title="Commons">Commons</a> 
   </div> 
   <div class="clear"> 
    <hr /> 
   </div> 
  </div> 
  <div id="leftColumn"> 
   <div id="navcolumn"> 
    <h5>Math</h5> 
    <ul> 
     <li class="none"> <a href="../index.html" title="Overview">Overview</a> </li> 
     <li class="none"> <a href="../download_math.cgi" title="Downloads">Downloads</a> </li> 
     <li class="none"> <a href="../apidocs/index.html" title="Latest API docs (development)">Latest API docs (development)</a> </li> 
     <li class="none"> <a href="../api-3.1.1/index.html" title="Javadoc (3.1.1 release)">Javadoc (3.1.1 release)</a> </li> 
     <li class="none"> <a href="../api-3.1/index.html" title="Javadoc (3.1 release)">Javadoc (3.1 release)</a> </li> 
     <li class="none"> <a href="../api-3.0/index.html" title="Javadoc (3.0 release)">Javadoc (3.0 release)</a> </li> 
     <li class="none"> <a href="../api-2.2/index.html" title="Javadoc (2.2 release)">Javadoc (2.2 release)</a> </li> 
     <li class="none"> <a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a> </li> 
     <li class="none"> <a href="http://svn.apache.org/viewvc/commons/proper/math/trunk" class="externalLink" title="Source Repository (current)">Source Repository (current)</a> </li> 
     <li class="none"> <a href="http://wiki.apache.org/commons/Math" class="externalLink" title="Wiki">Wiki</a> </li> 
     <li class="none"> <a href="../developers.html" title="Developers Guide">Developers Guide</a> </li> 
     <li class="none"> <a href="../proposal.html" title="Proposal">Proposal</a> </li> 
    </ul> 
    <h5>User Guide</h5> 
    <ul> 
     <li class="none"> <a href="../userguide/index.html" title="Contents">Contents</a> </li> 
     <li class="none"> <a href="../userguide/overview.html" title="Overview">Overview</a> </li> 
     <li class="none"> <a href="../userguide/stat.html" title="Statistics">Statistics</a> </li> 
     <li class="none"> <a href="../userguide/random.html" title="Data Generation">Data Generation</a> </li> 
     <li class="none"> <a href="../userguide/linear.html" title="Linear Algebra">Linear Algebra</a> </li> 
     <li class="none"> <a href="../userguide/analysis.html" title="Numerical Analysis">Numerical Analysis</a> </li> 
     <li class="none"> <a href="../userguide/special.html" title="Special Functions">Special Functions</a> </li> 
     <li class="none"> <a href="../userguide/utilities.html" title="Utilities">Utilities</a> </li> 
     <li class="none"> <a href="../userguide/complex.html" title="Complex Numbers">Complex Numbers</a> </li> 
     <li class="none"> <a href="../userguide/distribution.html" title="Distributions">Distributions</a> </li> 
     <li class="none"> <a href="../userguide/fraction.html" title="Fractions">Fractions</a> </li> 
     <li class="none"> <a href="../userguide/transform.html" title="Transform Methods">Transform Methods</a> </li> 
     <li class="none"> <a href="../userguide/geometry.html" title="3D Geometry">3D Geometry</a> </li> 
     <li class="none"> <strong>Optimization</strong> </li> 
     <li class="none"> <a href="../userguide/ode.html" title="Ordinary Differential Equations">Ordinary Differential Equations</a> </li> 
     <li class="none"> <a href="../userguide/genetics.html" title="Genetic Algorithms">Genetic Algorithms</a> </li> 
     <li class="none"> <a href="../userguide/filter.html" title="Filters">Filters</a> </li> 
    </ul> 
    <h5>Project Documentation</h5> 
    <ul> 
     <li class="collapsed"> <a href="../project-info.html" title="Project Information">Project Information</a> </li> 
     <li class="collapsed"> <a href="../project-reports.html" title="Project Reports">Project Reports</a> </li> 
    </ul> 
    <h5>Commons</h5> 
    <ul> 
     <li class="none"> <a href="../../" title="Home">Home</a> </li> 
     <li class="none"> <a href="http://www.apache.org/licenses/" class="externalLink" title="License">License</a> </li> 
     <li class="collapsed"> <a href="../../components.html" title="Components">Components</a> </li> 
     <li class="collapsed"> <a href="../../sandbox/index.html" title="Sandbox">Sandbox</a> </li> 
     <li class="collapsed"> <a href="../../dormant/index.html" title="Dormant">Dormant</a> </li> 
    </ul> 
    <h5>General Information</h5> 
    <ul> 
     <li class="none"> <a href="../../volunteering.html" title="Volunteering">Volunteering</a> </li> 
     <li class="none"> <a href="../../patches.html" title="Contributing Patches">Contributing Patches</a> </li> 
     <li class="none"> <a href="../../building.html" title="Building Components">Building Components</a> </li> 
     <li class="none"> <a href="../../releases/index.html" title="Releasing Components">Releasing Components</a> </li> 
     <li class="none"> <a href="http://wiki.apache.org/commons/FrontPage" class="externalLink" title="Wiki">Wiki</a> </li> 
    </ul> 
    <h5>ASF</h5> 
    <ul> 
     <li class="none"> <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a> </li> 
     <li class="none"> <a href="http://www.apache.org/foundation/getinvolved.html" class="externalLink" title="Get Involved">Get Involved</a> </li> 
     <li class="none"> <a href="http://www.apache.org/dev/" class="externalLink" title="Developer Resources">Developer Resources</a> </li> 
     <li class="none"> <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a> </li> 
     <li class="none"> <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a> </li> 
    </ul> 
    <a href="http://www.apache.org/events/current-event.html" title="ApacheCon" class="poweredBy"> <img class="poweredBy" alt="ApacheCon" src="http://www.apache.org/events/current-event-125x125.png" /> </a> 
    <a href="http://maven.apache.org/" title="Maven" class="poweredBy"> <img class="poweredBy" alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png" /> </a> 
   </div> 
  </div> 
  <div id="bodyColumn"> 
   <div id="contentBox"> 
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License. --> 
    <!-- $Id: optimization.html,v 1.1 2013/08/12 15:49:58 gpetro6 Exp $ --> 
    <div class="section"> 
     <h2>12 Optimization<a name="a12_Optimization"></a></h2> 
     <div class="section"> 
      <h3>12.1 Overview<a name="a12.1_Overview"></a></h3> 
      <p> The optimization package provides algorithms to optimize (i.e. either minimize or maximize) some objective or cost function. The package is split in several sub-packages dedicated to different kind of functions or algorithms. </p> 
      <ul> 
       <li>the univariate package handles univariate scalar functions,</li> 
       <li>the linear package handles multivariate vector linear functions with linear constraints,</li> 
       <li>the direct package handles multivariate scalar functions using direct search methods (i.e. not using derivatives),</li> 
       <li>the general package handles multivariate scalar or vector functions using derivatives.</li> 
       <li>the fitting package handles curve fitting by univariate real functions</li> 
      </ul> 
      <p> The top level optimization package provides common interfaces for the optimization algorithms provided in sub-packages. The main interfaces defines defines optimizers and convergence checkers. The functions that are optimized by the algorithms provided by this package and its sub-packages are a subset of the one defined in the <tt>analysis</tt> package, namely the real and vector valued functions. These functions are called objective function here. When the goal is to minimize, the functions are often called cost function, this name is not used in this package. </p> 
      <p> The type of goal, i.e. minimization or maximization, is defined by the enumerated <a href="../apidocs/org/apache/commons/math3/optimization/GoalType.html"> 
        <clt fqn="org.apache.commons.math3.optimization.GoalType" api="GoalType" kind="class">
          GoalType 
        </clt></a> which has only two values: <tt> 
        <clt fqn="org.apache.commons.math3.optimization.GoalType.MAXIMIZE" api="MAXIMIZE" kind="field">
          MAXIMIZE 
        </clt></tt> and <tt> 
        <clt fqn="org.apache.commons.math3.optimization.GoalType.MINIMIZE" api="MINIMIZE" kind="field">
          MINIMIZE 
        </clt></tt>. </p> 
      <p> Optimizers are the algorithms that will either minimize or maximize, the objective function by changing its input variables set until an optimal set is found. There are only four interfaces defining the common behavior of optimizers, one for each supported type of objective function: </p> 
      <ul> 
       <li><a href="../apidocs/org/apache/commons/math3/optimization/univariate/UnivariateOptimizer.html"> 
         <clt fqn="org.apache.commons.math3.optim.univariate.UnivariateOptimizer" api="UnivariateOptimizer" kind="class">
           UnivariateOptimizer 
         </clt></a> for <a href="../apidocs/org/apache/commons/math3/analysis/UnivariateFunction.html"> univariate real functions</a></li> 
       <li><a href="../apidocs/org/apache/commons/math3/optimization/MultivariateOptimizer.html"> 
         <clt fqn="org.apache.commons.math3.optimization.MultivariateOptimizer" api="MultivariateOptimizer" kind="class">
           MultivariateOptimizer 
         </clt></a> for <a href="../apidocs/org/apache/commons/math3/analysis/MultivariateFunction.html"> multivariate real functions</a></li> 
       <li><a href="../apidocs/org/apache/commons/math3/optimization/DifferentiableMultivariateOptimizer.html"> 
         <clt fqn="org.apache.commons.math3.optimization.DifferentiableMultivariateOptimizer" api="DifferentiableMultivariateOptimizer" kind="class">
           DifferentiableMultivariateOptimizer 
         </clt></a> for <a href="../apidocs/org/apache/commons/math3/analysis/DifferentiableMultivariateFunction.html"> differentiable multivariate real functions</a></li> 
       <li><a href="../apidocs/org/apache/commons/math3/optimization/DifferentiableMultivariateVectorOptimizer.html"> 
         <clt fqn="org.apache.commons.math3.optimization.DifferentiableMultivariateVectorOptimizer" api="DifferentiableMultivariateVectorOptimizer" kind="class">
           DifferentiableMultivariateVectorOptimizer 
         </clt></a> for <a href="../apidocs/org/apache/commons/math3/analysis/DifferentiableMultivariateVectorFunction.html"> differentiable multivariate vectorial functions</a></li> 
      </ul> 
      <p> Despite there are only four types of supported optimizers, it is possible to optimize a transform a <a href="../apidocs/org/apache/commons/math3/analysis/MultivariateVectorFunction.html"> non-differentiable multivariate vectorial function</a> by converting it to a <a href="../apidocs/org/apache/commons/math3/analysis/MultivariateFunction.html"> non-differentiable multivariate real function</a> thanks to the <a href="../apidocs/org/apache/commons/math3/optimization/LeastSquaresConverter.html"> 
        <clt fqn="org.apache.commons.math3.optimization.LeastSquaresConverter" api="LeastSquaresConverter" kind="class">
          LeastSquaresConverter 
        </clt></a> helper class. The transformed function can be optimized using any implementation of the <a href="../apidocs/org/apache/commons/math3/optimization/MultivariateOptimizer.html"> 
        <clt fqn="org.apache.commons.math3.optimization.MultivariateOptimizer" api="MultivariateOptimizer" kind="class">
          MultivariateOptimizer 
        </clt></a> interface. </p> 
      <p> For each of the four types of supported optimizers, there is a special implementation which wraps a classical optimizer in order to add it a multi-start feature. This feature call the underlying optimizer several times in sequence with different starting points and returns the best optimum found or all optima if desired. This is a classical way to prevent being trapped into a local extremum when looking for a global one. </p> 
     </div> 
     <div class="section"> 
      <h3>12.2 Univariate Functions<a name="a12.2_Univariate_Functions"></a></h3> 
      <p> A <a href="../apidocs/org/apache/commons/math3/optimization/univariate/UnivariateOptimizer.html"> 
        <clt fqn="org.apache.commons.math3.optim.univariate.UnivariateOptimizer" api="UnivariateOptimizer" kind="class">
          UnivariateOptimizer 
        </clt></a> is used to find the minimal values of a univariate real-valued function <tt>f</tt>. </p> 
      <p> These algorithms usage is very similar to root-finding algorithms usage explained in the analysis package. The main difference is that the <tt>solve</tt> methods in root finding algorithms is replaced by <tt> 
        <clt fqn="org.apache.commons.math3.optim.univariate.UnivariateOptimizer.optimize" api="optimize" kind="unknown">
          optimize 
        </clt></tt> methods. </p> 
     </div> 
     <div class="section"> 
      <h3>12.3 Linear Programming<a name="a12.3_Linear_Programming"></a></h3> 
      <p> This package provides an implementation of George Dantzig's simplex algorithm for solving linear optimization problems with linear equality and inequality constraints. </p> 
     </div> 
     <div class="section"> 
      <h3>12.4 Direct Methods<a name="a12.4_Direct_Methods"></a></h3> 
      <p> Direct search methods only use cost function values, they don't need derivatives and don't either try to compute approximation of the derivatives. According to a 1996 paper by Margaret H. Wright (<a class="externalLink" href="http://cm.bell-labs.com/cm/cs/doc/96/4-02.ps.gz">Direct Search Methods: Once Scorned, Now Respectable</a>), they are used when either the computation of the derivative is impossible (noisy functions, unpredictable discontinuities) or difficult (complexity, computation cost). In the first cases, rather than an optimum, a <i>not too bad</i> point is desired. In the latter cases, an optimum is desired but cannot be reasonably found. In all cases direct search methods can be useful. </p> 
      <p> Simplex-based direct search methods are based on comparison of the cost function values at the vertices of a simplex (which is a set of n+1 points in dimension n) that is updated by the algorithms steps. </p> 
      <p> The instances can be built either in single-start or in multi-start mode. Multi-start is a traditional way to try to avoid being trapped in a local minimum and miss the global minimum of a function. It can also be used to verify the convergence of an algorithm. In multi-start mode, the <tt>minimizes</tt>method returns the best minimum found after all starts, and the <tt>etMinima</tt> method can be used to retrieve all minima from all starts (including the one already provided by the <tt>minimizes</tt> method). </p> 
      <p> The <tt>direct</tt> package provides four solvers: </p> 
      <ul> 
       <li>the classical <a href="../apidocs/org/apache/commons/math3/optimization/direct/NelderMeadSimplex.html"> Nelder-Mead</a> method,</li> 
       <li>Virginia Torczon's <a href="../apidocs/org/apache/commons/math3/optimization/direct/MultiDirectionalSimplex.html"> multi-directional</a> method,</li> 
       <li>Nikolaus Hansen's <a href="../apidocs/org/apache/commons/math3/optimization/direct/CMAESOptimizer.html"> </a>Covariance Matrix Adaptation Evolution Strategy (CMA-ES),</li> 
       <li>Mike Powell's <a href="../apidocs/org/apache/commons/math3/optimization/direct/BOBYQAOptimizer.html"> BOBYQA</a> method. </li> 
      </ul> 
      <p> The first two simplex-based methods do not handle simple bounds constraints by themselves. However there are two adapters(<a href="../apidocs/org/apache/commons/math3/optimization/direct/MultivariateFunctionMappingAdapter.html"> 
        <clt fqn="org.apache.commons.math3.optimization.direct.MultivariateFunctionMappingAdapter" api="MultivariateFunctionMappingAdapter" kind="class">
          MultivariateFunctionMappingAdapter 
        </clt></a> and <a href="../apidocs/org/apache/commons/math3/optimization/direct/MultivariateFunctionPenaltyAdapter.html"> 
        <clt fqn="org.apache.commons.math3.optimization.direct.MultivariateFunctionPenaltyAdapter" api="MultivariateFunctionPenaltyAdapter" kind="class">
          MultivariateFunctionPenaltyAdapter 
        </clt></a>) that can be used to wrap the user function in such a way the wrapped function is unbounded and can be used with these optimizers, despite the fact the underlying function is still bounded and will be called only with feasible points that fulfill the constraints. Note however that using these adapters are only a poor man solutions to simple bounds optimization constraints. Better solutions are to use an optimizer that directly supports simple bounds. Some caveats of the mapping adapter solution are that </p> 
      <ul> 
       <li>behavior near the bounds may be numerically unstable as bounds are mapped from infinite values,</li> 
       <li>start value is evaluated by the optimizer as an unbounded variable, so it must be converted from bounded to unbounded by user,</li> 
       <li>optimum result is evaluated by the optimizer as an unbounded variable, so it must be converted from unbounded to bounded by user,</li> 
       <li>convergence values are evaluated by the optimizer as unbounded variables, so there will be scales differences when converted to bounded variables,</li> 
       <li>in the case of simplex based solvers, the initial simplex should be set up as delta in unbounded variables.</li> 
      </ul> One caveat of penalty adapter is that if start point or start simplex is outside of the allowed range, only the penalty function is used, and the optimizer may converge without ever entering the allowed range. 
      <p> The last methods do handle simple bounds constraints directly, so the adapters are not needed with them. </p> 
     </div> 
     <div class="section"> 
      <h3>12.5 General Case<a name="a12.5_General_Case"></a></h3> 
      <p> The general package deals with non-linear vectorial optimization problems when the partial derivatives of the objective function are available. </p> 
      <p> One important class of estimation problems is weighted least squares problems. They basically consist in finding the values for some parameters p<sub>k</sub> such that a cost function J = sum(w<sub>i</sub>(mes<sub>i</sub> - mod<sub>i</sub>)<sup>2</sup>) is minimized. The various (target<sub>i</sub> - model<sub>i</sub>(p<sub>k</sub>)) terms are called residuals. They represent the deviation between a set of target values target<sub>i</sub> and theoretical values computed from models model<sub>i</sub> depending on free parameters p<sub>k</sub>. The w<sub>i</sub> factors are weights. One classical use case is when the target values are experimental observations or measurements. </p> 
      <p> Solving a least-squares problem is finding the free parameters p<sub>k</sub> of the theoretical models such that they are close to the target values, i.e. when the residual are small. </p> 
      <p> Two optimizers are available in the general package, both devoted to least-squares problems. The first one is based on the <a href="../apidocs/org/apache/commons/math3/optimization/general/GaussNewtonOptimizer.html"> Gauss-Newton</a> method. The second one is the <a href="../apidocs/org/apache/commons/math3/optimization/general/LevenbergMarquardtOptimizer.html"> Levenberg-Marquardt</a> method. </p> 
      <p> In order to solve a vectorial optimization problem, the user must provide it as an object implementing the <a href="../apidocs/org/apache/commons/math3/analysis/DifferentiableMultivariateVectorFunction.html"> 
        <clt fqn="org.apache.commons.math3.analysis.DifferentiableMultivariateVectorFunction" api="DifferentiableMultivariateVectorFunction" kind="class">
          DifferentiableMultivariateVectorFunction 
        </clt></a> interface. The object will be provided to the <tt>estimate</tt> method of the optimizer, along with the target and weight arrays, thus allowing the optimizer to compute the residuals at will. The last parameter to the <tt>estimate</tt> method is the point from which the optimizer will start its search for the optimal point. </p> 
      <dl> 
       <dt>
         Quadratic Problem Example 
       </dt> 
       <dd>
         We are looking to find the best parameters [a, b, c] for the quadratic function 
        <b><tt>f(x) = a x<sup>2</sup> + b x + c</tt></b>. The data set below was generated using [a = 8, b = 10, c = 16]. A random number between zero and one was added to each y value calculated. 
        <table border="0" class="bodyTable" cellspacing="0" cellpadding="3"> 
         <tbody> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;"><b>X</b></td> 
           <td valign="bottom" align="center" style=" font-size:10pt;"><b>Y</b></td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">34.234064369</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">2</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">68.2681162306108</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">3</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">118.615899084602</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">4</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">184.138197238557</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">5</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">266.599877916276</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">6</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">364.147735251579</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">7</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">478.019226091914</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">8</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">608.140949270688</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">9</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">754.598868667148</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">10</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">916.128818085883</td> 
          </tr> 
         </tbody> 
        </table> 
        <p> First we need to implement the interface <a href="../apidocs/org/apache/commons/math3/analysis/DifferentiableMultivariateVectorFunction.html"> 
          <clt fqn="org.apache.commons.math3.analysis.DifferentiableMultivariateVectorFunction" api="DifferentiableMultivariateVectorFunction" kind="class">
            DifferentiableMultivariateVectorFunction 
          </clt></a>. This requires the implementation of the method signatures: </p> 
        <ul> 
         <li><b>MultivariateMatrixFunction jacobian()</b></li> 
         <li><b>double[] value(double[] point)</b></li> 
        </ul> 
        <p> We'll tackle the implementation of the <tt> 
          <clt fqn="org.apache.commons.math3.analysis.DifferentiableMultivariateVectorFunction.jacobian" api="jacobian" kind="method">
            MultivariateMatrixFunction jacobian() 
          </clt></tt> method first. You may wish to familiarize yourself with what a <a class="externalLink" href="http://en.wikipedia.org/wiki/Jacobian_matrix_and_determinant"> Jacobian Matrix</a> is. In this case the Jacobian is the partial derivative of the function with respect to the parameters a, b and c. These derivatives are computed as follows: </p> 
        <ul> 
         <li>d(ax<sup>2</sup> + bx + c)/da = x<sup>2</sup></li> 
         <li>d(ax<sup>2</sup> + bx + c)/db = x</li> 
         <li>d(ax<sup>2</sup> + bx + c)/dc = 1</li> 
        </ul> 
        <p> For a quadratic which has three variables the Jacobian Matrix will have three columns, one for each variable, and the number of rows will equal the number of rows in our data set, which in this case is ten. So for example for <tt>[a = 1, b = 1, c = 1]</tt>, the Jacobian Matrix is (excluding the first column which shows the value of x): </p> 
        <table border="0" class="bodyTable" cellspacing="0" cellpadding="3"> 
         <tbody> 
          <tr class="a"> 
           <td valign="bottom" align="left" style=" font-size:10pt;"><b>x</b></td> 
           <td valign="bottom" align="left" style=" font-size:10pt;"><b>d(ax<sup>2</sup> + bx + c)/da</b></td> 
           <td valign="bottom" align="left" style=" font-size:10pt;"><b>d(ax<sup>2</sup> + bx + c)/db</b></td> 
           <td valign="bottom" align="left" style=" font-size:10pt;"><b>d(ax<sup>2</sup> + bx + c)/dc</b></td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">2</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">4</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">2</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">3</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">9</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">3</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">4</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">16</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">4</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">5</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">25</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">5</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">6</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">36</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">6</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">7</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">49</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">7</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">8</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">64</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">8</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="b"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">9</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">81</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">9</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
          <tr class="a"> 
           <td valign="bottom" align="center" style=" font-size:10pt;">10</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">100</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">10</td> 
           <td valign="bottom" align="center" style=" font-size:10pt;">1</td> 
          </tr> 
         </tbody> 
        </table> 
        <p> The implementation of the <tt> 
          <clt fqn="org.apache.commons.math3.analysis.DifferentiableMultivariateVectorFunction.jacobian" api="jacobian" kind="method">
            MultivariateMatrixFunction jacobian() 
          </clt></tt> for this problem looks like this (The <tt>x</tt> parameter is an ArrayList containing the independent values of the data set): </p> 
        <div class="source"> 
         <pre>
 private double[][] jacobian(double[] variables) {
     double[][] jacobian = new double[x.size()][3];
     for (int i = 0; i &lt; jacobian.length; ++i) {
         jacobian[i][0] = x.get(i) * x.get(i);
         jacobian[i][1] = x.get(i);
         jacobian[i][2] = 1.0;
     }
     return jacobian;
 }

 public MultivariateMatrixFunction jacobian() {
     return new MultivariateMatrixFunction() {
         private static final long serialVersionUID = -8673650298627399464L;
         public double[][] value(double[] point) {
             return jacobian(point);
         }
     };
 }
</pre> 
        </div> 
        <p> Note that if for some reason the derivative of the objective function with respect to its variables is difficult to obtain, <a class="externalLink" href="http://en.wikipedia.org/wiki/Numerical_differentiation">Numerical differentiation</a> can be used. </p> 
        <p> The implementation of the <tt> 
          <clt fqn="org.apache.commons.math3.analysis.MultivariateMatrixFunction.value" api="value" kind="method">
            double[] value(double[] point) 
          </clt></tt> method, which returns a <tt>double</tt> array containing the values the objective function returns per given independent value and the current set of variables or parameters, can be seen below: </p> 
        <div class="source"> 
         <pre>
    public double[] value(double[] variables) {
        double[] values = new double[x.size()];
        for (int i = 0; i &lt; values.length; ++i) {
            values[i] = (variables[0] * x.get(i) + variables[1]) * x.get(i) + variables[2];
        }
        return values;
    }
</pre> 
        </div> 
        <p> Below is the the class containing all the implementation details (Taken from the Apache Commons Math <b>org.apache.commons.math3.optimization.general.LevenbergMarquardtOptimizerTest</b>): </p> 
        <div class="source"> 
         <pre>
private static class QuadraticProblem
    implements DifferentiableMultivariateVectorFunction, Serializable {

    private static final long serialVersionUID = 7072187082052755854L;
    private List&lt;Double&gt; x;
    private List&lt;Double&gt; y;

    public QuadraticProblem() {
        x = new ArrayList&lt;Double&gt;();
        y = new ArrayList&lt;Double&gt;();
    }

    public void addPoint(double x, double y) {
        this.x.add(x);
        this.y.add(y);
    }

    public double[] calculateTarget() {
    	double[] target = new double[y.size()];
    	for (int i = 0; i &lt; y.size(); i++) {
    		target[i] = y.get(i).doubleValue();
    	}
    	return target;
    }

    private double[][] jacobian(double[] variables) {
        double[][] jacobian = new double[x.size()][3];
        for (int i = 0; i &lt; jacobian.length; ++i) {
            jacobian[i][0] = x.get(i) * x.get(i);
            jacobian[i][1] = x.get(i);
            jacobian[i][2] = 1.0;
        }
        return jacobian;
    }

    public double[] value(double[] variables) {
        double[] values = new double[x.size()];
        for (int i = 0; i &lt; values.length; ++i) {
            values[i] = (variables[0] * x.get(i) + variables[1]) * x.get(i) + variables[2];
        }
        return values;
    }

    public MultivariateMatrixFunction jacobian() {
        return new MultivariateMatrixFunction() {
            private static final long serialVersionUID = -8673650298627399464L;
            public double[][] value(double[] point) {
                return jacobian(point);
            }
        };
    }
}
</pre> 
        </div> 
        <p> The below code shows how to go about using the above class and a LevenbergMarquardtOptimizer instance to produce an optimal set of quadratic curve fitting parameters: </p> 
        <div class="source"> 
         <pre>
 QuadraticProblem problem = new QuadraticProblem();

 problem.addPoint(1, 34.234064369);
 problem.addPoint(2, 68.2681162306);
 problem.addPoint(3, 118.6158990846);
 problem.addPoint(4, 184.1381972386);
 problem.addPoint(5, 266.5998779163);
 problem.addPoint(6, 364.1477352516);
 problem.addPoint(7, 478.0192260919);
 problem.addPoint(8, 608.1409492707);
 problem.addPoint(9, 754.5988686671);
 problem.addPoint(10, 916.1288180859);

 LevenbergMarquardtOptimizer optimizer = new LevenbergMarquardtOptimizer();

 final double[] weights = { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 };

 final double[] initialSolution = {1, 1, 1};

 PointVectorValuePair optimum = optimizer.optimize(100,
                                                   problem,
                                                   problem.calculateTarget(),
                                                   weights,
                                                   initialSolution);

 final double[] optimalValues = optimum.getPoint();

 System.out.println(&quot;A: &quot; + optimalValues[0]);
 System.out.println(&quot;B: &quot; + optimalValues[1]);
 System.out.println(&quot;C: &quot; + optimalValues[2]);

    </pre> 
        </div> 
        <p> If you run the above sample you will see the following printed by the console: </p> 
        <div> 
         <pre>
A: 7.998832172372726
B: 10.001841530162448
C: 16.324008168386605
</pre> 
        </div> 
       </dd> 
      </dl> 
      <p> In addition to least squares solving, the <a href="../apidocs/org/apache/commons/math3/optimization/general/NonLinearConjugateGradientOptimizer.html"> 
        <clt fqn="org.apache.commons.math3.optimization.general.NonLinearConjugateGradientOptimizer" api="NonLinearConjugateGradientOptimizer" kind="class">
          NonLinearConjugateGradientOptimizer 
        </clt></a> class provides a non-linear conjugate gradient algorithm to optimize <a href="../apidocs/org/apache/commons/math3/analysis/DifferentiableMultivariateFunction.html"> 
        <clt fqn="org.apache.commons.math3.analysis.DifferentiableMultivariateFunction" api="DifferentiableMultivariateFunction" kind="class">
          DifferentiableMultivariateFunction 
        </clt></a>. Both the Fletcher-Reeves and the Polak-Ribi&egrave;re search direction update methods are supported. It is also possible to set up a preconditioner or to change the line-search algorithm of the inner loop if desired (the default one is a Brent solver). </p> 
      <p> The <a href="../apidocs/org/apache/commons/math3/optimization/direct/PowellOptimizer.html"> 
        <clt fqn="org.apache.commons.math3.optimization.direct.PowellOptimizer" api="PowellOptimizer" kind="class">
          PowellOptimizer 
        </clt></a> provides an optimization method for non-differentiable functions. </p> 
     </div> 
     <div class="section"> 
      <h3>12.6 Curve Fitting<a name="a12.6_Curve_Fitting"></a></h3> 
      <p> The fitting package deals with curve fitting for univariate real functions. When a univariate real function y = f(x) does depend on some unknown parameters p<sub>0</sub>, p<sub>1</sub> ... p<sub>n-1</sub>, curve fitting can be used to find these parameters. It does this by <i>fitting</i> the curve so it remains very close to a set of observed points (x<sub>0</sub>, y<sub>0</sub>), (x<sub>1</sub>, y<sub>1</sub>) ... (x<sub>k-1</sub>, y<sub>k-1</sub>). This fitting is done by finding the parameters values that minimizes the objective function sum(y<sub>i</sub>-f(x<sub>i</sub>))<sup>2</sup>. This is really a least squares problem. </p> 
      <p> For all provided curve fitters, the operating principle is the same. Users must first create an instance of the fitter, then add the observed points and once the complete sample of observed points has been added they must call the <tt>
        <clt fqn="org.apache.commons.math3.fitting.CurveFitter.fit" api="fit" kind="unknown">
         fit
        </clt></tt> method which will compute the parameters that best fit the sample. A weight is associated with each observed point, this allows to take into account uncertainty on some points when they come from loosy measurements for example. If no such information exist and all points should be treated the same, it is safe to put 1.0 as the weight for all points. </p> 
      <p> The <a href="../apidocs/org/apache/commons/math3/optimization/fitting/CurveFitter.html"> 
        <clt fqn="org.apache.commons.math3.fitting.CurveFitter" api="CurveFitter" kind="class">
          CurveFitter 
        </clt></a> class provides curve fitting for general curves. Users must provide their own implementation of the curve template as a class implementing the <a href="../apidocs/org/apache/commons/math3/analysis/ParametricUnivariateFunction.html"> 
        <clt fqn="org.apache.commons.math3.analysis.ParametricUnivariateFunction" api="ParametricUnivariateFunction" kind="class">
          ParametricUnivariateFunction 
        </clt></a> interface and they must provide the initial guess of the parameters. </p> 
      <p> The following example shows how to fit data with a polynomial function. </p> 
      <div class="source"> 
       <pre>final CurveFitter fitter = new CurveFitter(new LevenbergMarquardtOptimizer());
fitter.addObservedPoint(-1.00, 2.021170021833143);
fitter.addObservedPoint(-0.99, 2.221135431136975);
fitter.addObservedPoint(-0.98, 2.09985277659314);
fitter.addObservedPoint(-0.97, 2.0211192647627025);
// ... Lots of lines omitted ...
fitter.addObservedPoint( 0.99, -2.4345814727089854);

// The degree of the polynomial is deduced from the length of the array containing
// the initial guess for the coefficients of the polynomial.
final double[] init = { 12.9, -3.4, 2.1 }; // 12.9 - 3.4 x + 2.1 x^2

// Compute optimal coefficients.
final double[] best = fitter.fit(new PolynomialFunction.Parametric(), init);

// Construct the polynomial that best fits the data.
final PolynomialFunction fitted = new PolynomialFunction(best);
        </pre> 
      </div> 
      <p> The more specialized <a href="../apidocs/org/apache/commons/math3/optimization/fitting/HarmonicFitter.html"> 
        <clt fqn="org.apache.commons.math3.fitting.HarmonicFitter" api="HarmonicFitter" kind="class">
          HarmonicFitter 
        </clt></a> classes requires neither an implementation of the parametric real function nor an initial guess as it is are able to compute them internally. </p> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="clear"> 
   <hr /> 
  </div> 
  <div id="footer"> 
   <div class="center">
     Copyright &copy; 2003-2013 
    <a href="http://www.apache.org/">The Apache Software Foundation</a>. All Rights Reserved. 
   </div> 
   <div class="center">
     Apache Commons, Apache Commons Math, Apache, the Apache feather logo, and the Apache Commons project logos are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. 
   </div> 
   <div class="clear"> 
    <hr /> 
   </div> 
  </div>  
 </body>
</html>