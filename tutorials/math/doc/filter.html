<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jan 9, 2013 ( $Revision: 1.1 $ ) -->
<!-- $HeadURL: https://svn.apache.org/repos/asf/commons/proper/commons-skin/trunk/src/main/resources/META-INF/maven/site.vm $ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
  <title>
    The Commons Math User Guide - Filters</title> 
  <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style> 
  <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" /> 
  <meta name="Date-Revision-yyyymmdd" content="20130109" /> 
  <meta http-equiv="Content-Language" content="en" /> 
  <link rel="stylesheet" type="text/css" media="all" href="../css/prettify.css" /> 
  <script src="../js/prettify.js" type="text/javascript"></script> 
  <script type="text/javascript">window.onload=function() {
            prettyPrint();
        }</script> 
 </head> 
 <body class="composite"> 
  <div id="banner"> 
   <div id="bannerLeft"> 
    <a href="http://commons.apache.org/" title="Apache Commons logo"> <img src="../images/commons-logo.png" alt="Apache Commons logo" /> </a> 
   </div>
   <!-- id="bannerLeft" --> 
   <div id="bannerRight"> 
    <a href="../index.html"> <img src="../images/math.gif" alt="Commons Math" /> </a> 
   </div>
   <!-- id="bannerRight" --> 
   <div class="clear"> 
    <hr /> 
   </div> 
  </div> 
  <div id="breadcrumbs"> 
   <div class="xleft"> 
    <span id="publishDate">Last Published: 09 January 2013</span> &nbsp;| 
    <span id="projectVersion">Version: 3.1.1</span> 
   </div> 
   <div class="xright"> 
    <a href="http://www.apachecon.com/" class="externalLink" title="ApacheCon">ApacheCon</a> | 
    <a href="http://www.apache.org" class="externalLink" title="Apache">Apache</a> | 
    <a href="../../" title="Commons">Commons</a> 
   </div> 
   <div class="clear"> 
    <hr /> 
   </div> 
  </div> 
  <div id="leftColumn"> 
   <div id="navcolumn"> 
    <h5>Math</h5> 
    <ul> 
     <li class="none"> <a href="../index.html" title="Overview">Overview</a> </li> 
     <li class="none"> <a href="../download_math.cgi" title="Downloads">Downloads</a> </li> 
     <li class="none"> <a href="../apidocs/index.html" title="Latest API docs (development)">Latest API docs (development)</a> </li> 
     <li class="none"> <a href="../api-3.1.1/index.html" title="Javadoc (3.1.1 release)">Javadoc (3.1.1 release)</a> </li> 
     <li class="none"> <a href="../api-3.1/index.html" title="Javadoc (3.1 release)">Javadoc (3.1 release)</a> </li> 
     <li class="none"> <a href="../api-3.0/index.html" title="Javadoc (3.0 release)">Javadoc (3.0 release)</a> </li> 
     <li class="none"> <a href="../api-2.2/index.html" title="Javadoc (2.2 release)">Javadoc (2.2 release)</a> </li> 
     <li class="none"> <a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a> </li> 
     <li class="none"> <a href="http://svn.apache.org/viewvc/commons/proper/math/trunk" class="externalLink" title="Source Repository (current)">Source Repository (current)</a> </li> 
     <li class="none"> <a href="http://wiki.apache.org/commons/Math" class="externalLink" title="Wiki">Wiki</a> </li> 
     <li class="none"> <a href="../developers.html" title="Developers Guide">Developers Guide</a> </li> 
     <li class="none"> <a href="../proposal.html" title="Proposal">Proposal</a> </li> 
    </ul> 
    <h5>User Guide</h5> 
    <ul> 
     <li class="none"> <a href="../userguide/index.html" title="Contents">Contents</a> </li> 
     <li class="none"> <a href="../userguide/overview.html" title="Overview">Overview</a> </li> 
     <li class="none"> <a href="../userguide/stat.html" title="Statistics">Statistics</a> </li> 
     <li class="none"> <a href="../userguide/random.html" title="Data Generation">Data Generation</a> </li> 
     <li class="none"> <a href="../userguide/linear.html" title="Linear Algebra">Linear Algebra</a> </li> 
     <li class="none"> <a href="../userguide/analysis.html" title="Numerical Analysis">Numerical Analysis</a> </li> 
     <li class="none"> <a href="../userguide/special.html" title="Special Functions">Special Functions</a> </li> 
     <li class="none"> <a href="../userguide/utilities.html" title="Utilities">Utilities</a> </li> 
     <li class="none"> <a href="../userguide/complex.html" title="Complex Numbers">Complex Numbers</a> </li> 
     <li class="none"> <a href="../userguide/distribution.html" title="Distributions">Distributions</a> </li> 
     <li class="none"> <a href="../userguide/fraction.html" title="Fractions">Fractions</a> </li> 
     <li class="none"> <a href="../userguide/transform.html" title="Transform Methods">Transform Methods</a> </li> 
     <li class="none"> <a href="../userguide/geometry.html" title="3D Geometry">3D Geometry</a> </li> 
     <li class="none"> <a href="../userguide/optimization.html" title="Optimization">Optimization</a> </li> 
     <li class="none"> <a href="../userguide/ode.html" title="Ordinary Differential Equations">Ordinary Differential Equations</a> </li> 
     <li class="none"> <a href="../userguide/genetics.html" title="Genetic Algorithms">Genetic Algorithms</a> </li> 
     <li class="none"> <strong>Filters</strong> </li> 
    </ul> 
    <h5>Project Documentation</h5> 
    <ul> 
     <li class="collapsed"> <a href="../project-info.html" title="Project Information">Project Information</a> </li> 
     <li class="collapsed"> <a href="../project-reports.html" title="Project Reports">Project Reports</a> </li> 
    </ul> 
    <h5>Commons</h5> 
    <ul> 
     <li class="none"> <a href="../../" title="Home">Home</a> </li> 
     <li class="none"> <a href="http://www.apache.org/licenses/" class="externalLink" title="License">License</a> </li> 
     <li class="collapsed"> <a href="../../components.html" title="Components">Components</a> </li> 
     <li class="collapsed"> <a href="../../sandbox/index.html" title="Sandbox">Sandbox</a> </li> 
     <li class="collapsed"> <a href="../../dormant/index.html" title="Dormant">Dormant</a> </li> 
    </ul> 
    <h5>General Information</h5> 
    <ul> 
     <li class="none"> <a href="../../volunteering.html" title="Volunteering">Volunteering</a> </li> 
     <li class="none"> <a href="../../patches.html" title="Contributing Patches">Contributing Patches</a> </li> 
     <li class="none"> <a href="../../building.html" title="Building Components">Building Components</a> </li> 
     <li class="none"> <a href="../../releases/index.html" title="Releasing Components">Releasing Components</a> </li> 
     <li class="none"> <a href="http://wiki.apache.org/commons/FrontPage" class="externalLink" title="Wiki">Wiki</a> </li> 
    </ul> 
    <h5>ASF</h5> 
    <ul> 
     <li class="none"> <a href="http://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a> </li> 
     <li class="none"> <a href="http://www.apache.org/foundation/getinvolved.html" class="externalLink" title="Get Involved">Get Involved</a> </li> 
     <li class="none"> <a href="http://www.apache.org/dev/" class="externalLink" title="Developer Resources">Developer Resources</a> </li> 
     <li class="none"> <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a> </li> 
     <li class="none"> <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a> </li> 
    </ul> 
    <a href="http://www.apache.org/events/current-event.html" title="ApacheCon" class="poweredBy"> <img class="poweredBy" alt="ApacheCon" src="http://www.apache.org/events/current-event-125x125.png" /> </a> 
    <a href="http://maven.apache.org/" title="Maven" class="poweredBy"> <img class="poweredBy" alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png" /> </a> 
   </div> 
  </div> 
  <div id="bodyColumn"> 
   <div id="contentBox"> 
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at
   
         http://www.apache.org/licenses/LICENSE-2.0
   
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License. -->
    <!-- $Id: filter.html,v 1.1 2013/08/12 15:50:03 gpetro6 Exp $ --> 
    <div class="section">
     <h2>15 Filters<a name="a15_Filters"></a></h2> 
     <div class="section">
      <h3>15.1 Overview<a name="a15.1_Overview"></a></h3> 
      <p> The filter package currently provides only an implementation of a Kalman filter. </p> 
     </div> 
     <div class="section">
      <h3>15.2 Kalman Filter<a name="a15.2_Kalman_Filter"></a></h3> 
      <p> <a href="../apidocs/org/apache/commons/math3/filter/KalmanFilter.html"> KalmanFilter</a> provides a discrete-time filter to estimate a stochastic linear process.</p> 
      <p>A Kalman filter is initialized with a <a href="../apidocs/org/apache/commons/math3/filter/ProcessModel.html"> ProcessModel</a> and a <a href="../apidocs/org/apache/commons/math3/filter/MeasurementModel.html"> MeasurementModel</a>, which contain the corresponding transformation and noise covariance matrices. The parameter names used in the respective models correspond to the following names commonly used in the mathematical literature: </p>
      <ul> 
       <li>A - state transition matrix</li> 
       <li>B - control input matrix</li> 
       <li>H - measurement matrix</li> 
       <li>Q - process noise covariance matrix</li> 
       <li>R - measurement noise covariance matrix</li> 
       <li>P - error covariance matrix</li> 
      </ul> 
      <p> </p>
      <dl> 
       <dt>
        Initialization
       </dt> 
       <dd>
         The following code will create a Kalman filter using the provided DefaultMeasurementModel and DefaultProcessModel classes. To support dynamically changing process and measurement noises, simply implement your own models. 
        <div class="source">
         <pre>
// A = [ 1 ]
RealMatrix A = new Array2DRowRealMatrix(new double[] { 1d });
// no control input
RealMatrix B = null;
// H = [ 1 ]
RealMatrix H = new Array2DRowRealMatrix(new double[] { 1d });
// Q = [ 0 ]
RealMatrix Q = new Array2DRowRealMatrix(new double[] { 0 });
// R = [ 0 ]
RealMatrix R = new Array2DRowRealMatrix(new double[] { 0 });

ProcessModel pm
   = new DefaultProcessModel(A, B, Q, new ArrayRealVector(new double[] { 0 }), null);
MeasurementModel mm = new DefaultMeasurementModel(H, R);
KalmanFilter filter = new KalmanFilter(pm, mm);
 			</pre>
        </div> 
       </dd> 
       <dt>
        Iteration
       </dt> 
       <dd>
        The following code illustrates how to perform the predict/correct cycle: 
        <div class="source">
         <pre>
for (;;) {
   // predict the state estimate one time-step ahead
   // optionally provide some control input
   filter.predict();

   // obtain measurement vector z
   RealVector z = getMeasurement();

   // correct the state estimate with the latest measurement
   filter.correct(z);
   
   double[] stateEstimate = filter.getStateEstimation();
   // do something with it
}
		  </pre>
        </div> 
       </dd> 
       <dt>
        Constant Voltage Example
       </dt> 
       <dd>
        The following example creates a Kalman filter for a static process: a system with a constant voltage as internal state. We observe this process with an artificially imposed measurement noise of 0.1V and assume an internal process noise of 1e-5V. 
        <div class="source">
         <pre>
double constantVoltage = 10d;
double measurementNoise = 0.1d;
double processNoise = 1e-5d;

// A = [ 1 ]
RealMatrix A = new Array2DRowRealMatrix(new double[] { 1d });
// B = null
RealMatrix B = null;
// H = [ 1 ]
RealMatrix H = new Array2DRowRealMatrix(new double[] { 1d });
// x = [ 10 ]
RealVector x = new ArrayRealVector(new double[] { constantVoltage });
// Q = [ 1e-5 ]
RealMatrix Q = new Array2DRowRealMatrix(new double[] { processNoise });
// P = [ 1 ]
RealMatrix P0 = new Array2DRowRealMatrix(new double[] { 1d });
// R = [ 0.1 ]
RealMatrix R = new Array2DRowRealMatrix(new double[] { measurementNoise });

ProcessModel pm = new DefaultProcessModel(A, B, Q, x, P0);
MeasurementModel mm = new DefaultMeasurementModel(H, R);
KalmanFilter filter = new KalmanFilter(pm, mm);  

// process and measurement noise vectors
RealVector pNoise = new ArrayRealVector(1);
RealVector mNoise = new ArrayRealVector(1);

RandomGenerator rand = new JDKRandomGenerator();
// iterate 60 steps
for (int i = 0; i &lt; 60; i++) {
    filter.predict();

    // simulate the process
    pNoise.setEntry(0, processNoise * rand.nextGaussian());

    // x = A * x + p_noise
    x = A.operate(x).add(pNoise);

    // simulate the measurement
    mNoise.setEntry(0, measurementNoise * rand.nextGaussian());

    // z = H * x + m_noise
    RealVector z = H.operate(x).add(mNoise);

    filter.correct(z);

    double voltage = filter.getStateEstimation()[0];
}
          </pre>
        </div> 
       </dd> 
       <dt>
        Increasing Speed Vehicle Example
       </dt> 
       <dd>
        The following example creates a Kalman filter for a simple linear process: a vehicle driving along a street with a velocity increasing at a constant rate. The process state is modeled as (position, velocity) and we only observe the position. A measurement noise of 10m is imposed on the simulated measurement. 
        <div class="source">
         <pre>
// discrete time interval
double dt = 0.1d;
// position measurement noise (meter)
double measurementNoise = 10d;
// acceleration noise (meter/sec^2)
double accelNoise = 0.2d;

// A = [ 1 dt ]
//     [ 0  1 ]
RealMatrix A = new Array2DRowRealMatrix(new double[][] { { 1, dt }, { 0, 1 } });
// B = [ dt^2/2 ]
//     [ dt     ]
RealMatrix B = new Array2DRowRealMatrix(new double[][] { { Math.pow(dt, 2d) / 2d }, { dt } });
// H = [ 1 0 ]
RealMatrix H = new Array2DRowRealMatrix(new double[][] { { 1d, 0d } });
// x = [ 0 0 ]
RealVector x = new ArrayRealVector(new double[] { 0, 0 });

RealMatrix tmp = new Array2DRowRealMatrix(new double[][] {
    { Math.pow(dt, 4d) / 4d, Math.pow(dt, 3d) / 2d },
    { Math.pow(dt, 3d) / 2d, Math.pow(dt, 2d) } });
// Q = [ dt^4/4 dt^3/2 ]
//     [ dt^3/2 dt^2   ]
RealMatrix Q = tmp.scalarMultiply(Math.pow(accelNoise, 2));
// P0 = [ 1 1 ]
//      [ 1 1 ]
RealMatrix P0 = new Array2DRowRealMatrix(new double[][] { { 1, 1 }, { 1, 1 } });
// R = [ measurementNoise^2 ]
RealMatrix R = new Array2DRowRealMatrix(new double[] { Math.pow(measurementNoise, 2) });

// constant control input, increase velocity by 0.1 m/s per cycle
RealVector u = new ArrayRealVector(new double[] { 0.1d });

ProcessModel pm = new DefaultProcessModel(A, B, Q, x, P0);
MeasurementModel mm = new DefaultMeasurementModel(H, R);
KalmanFilter filter = new KalmanFilter(pm, mm);

RandomGenerator rand = new JDKRandomGenerator();

RealVector tmpPNoise = new ArrayRealVector(new double[] { Math.pow(dt, 2d) / 2d, dt });
RealVector mNoise = new ArrayRealVector(1);

// iterate 60 steps
for (int i = 0; i &lt; 60; i++) {
    filter.predict(u);

    // simulate the process
    RealVector pNoise = tmpPNoise.mapMultiply(accelNoise * rand.nextGaussian());

    // x = A * x + B * u + pNoise
    x = A.operate(x).add(B.operate(u)).add(pNoise);

    // simulate the measurement
    mNoise.setEntry(0, measurementNoise * rand.nextGaussian());

    // z = H * x + m_noise
    RealVector z = H.operate(x).add(mNoise);

    filter.correct(z);

    double position = filter.getStateEstimation()[0];
    double velocity = filter.getStateEstimation()[1];
}
          </pre>
        </div> 
       </dd> 
      </dl> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="clear"> 
   <hr /> 
  </div> 
  <div id="footer"> 
   <div class="center">
    Copyright &copy; 2003-2013 
    <a href="http://www.apache.org/">The Apache Software Foundation</a>. All Rights Reserved. 
   </div> 
   <div class="center">
    Apache Commons, Apache Commons Math, Apache, the Apache feather logo, and the Apache Commons project logos are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
   </div> 
   <div class="clear"> 
    <hr /> 
   </div> 
  </div>   
 </body>
</html>